<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>住驻专转 专转 注 拽驻</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{height:100vh;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;overflow:hidden;transition:background 0.5s ease;position:relative;}
.progress-container{width:100%;height:20px;background:rgba(255,255,255,0.2);}
.progress-bar{height:100%;width:0%;background:#ff6b6b;transition:width 0.3s ease, background 0.5s ease;}
.digit-container{flex:1;display:flex;justify-content:center;align-items:center;width:100%;}
.digit-display{font-size:15rem;font-weight:bold;color:white;text-shadow:0 0 30px rgba(0,0,0,0.5);transition: all 0.3s ease;user-select:none;}
.digit-display.animate{transform:scale(1.2);text-shadow:0 0 50px rgba(0,0,0,0.8);}
.button-container{padding:20px 20px;width:100%;display:flex;flex-direction:column;align-items:center;gap:15px;}
.generate-btn{background:linear-gradient(45deg,#ff6b6b,#ee5a24);border:none;border-radius:50px;color:white;font-size:1.5rem;font-weight:bold;padding:20px 40px;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.3);transition:all 0.3s ease;min-width:200px;}
.generate-btn:hover{transform:translateY(-3px);box-shadow:0 15px 40px rgba(0,0,0,0.4);}
.generate-btn:active{transform:translateY(0);box-shadow:0 5px 20px rgba(0,0,0,0.3);}
.read-btn{background:linear-gradient(45deg,#4ecdc4,#44a08d);border:none;border-radius:50px;color:white;font-size:1.3rem;font-weight:bold;padding:15px 30px;cursor:pointer;box-shadow:0 8px 25px rgba(0,0,0,0.3);transition:all 0.3s ease;min-width:160px;opacity:0;transform:translateY(20px);visibility:hidden;}
.read-btn.show{opacity:1;transform:translateY(0);visibility:visible;}
.read-btn:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,0,0,0.4);}
.read-btn:active{transform:translateY(0);box-shadow:0 4px 15px rgba(0,0,0,0.3);}
.welcome-text{color:white;font-size:1.2rem;text-align:center;opacity:0.8;margin-top:50px;}
.confetti{position:absolute;pointer-events:none;animation:fall linear forwards;}
@keyframes fall{0%{transform:translateY(0) rotate(0deg);}100%{transform:translateY(100vh) rotate(720deg);}}
@media(max-width:480px){.digit-display{font-size:12rem;}.generate-btn{font-size:1.3rem;padding:18px 35px;min-width:180px;}.read-btn{font-size:1.1rem;padding:12px 25px;min-width:140px;}.welcome-text{font-size:1rem;margin-top:30px;}.button-container{padding:20px 20px;}}
@media(max-width:320px){.digit-display{font-size:10rem;}.generate-btn{font-size:1.2rem;padding:15px 30px;min-width:160px;}.read-btn{font-size:1rem;padding:10px 20px;min-width:120px;}}
</style>
</head>
<body>
<div class="progress-container">
    <div id="progressBar" class="progress-bar"></div>
</div>
<div class="digit-container">
    <div id="digitDisplay" class="digit-display">
        <div class="welcome-text">抓 注 驻转专 住驻专 专转</div>
    </div>
</div>
<div class="button-container">
    <button id="generateBtn" class="generate-btn" onclick="generateRandomDigit()">住驻专 专转</button>
    <button id="readBtn" class="read-btn" onclick="playAudio()"> 拽专</button>
</div>
<script>
let isFirstClick=true;
let currentDigit=null;
let fontClasses=[];
let lastDigits=[];
let lastFonts=[];
let currentColorIndex=0;
let colorClickCounter=parseInt(getCookie("colorClickCounter"))||0;
let level=parseInt(getCookie("level"))||1;
let firstLevelExtraClick=true;
let currentColorObj=null;

const sequenceColors=[
    {color:'#ff6b6b', bg:'#6a6fd5'},
    {color:'#ffbe76', bg:'#ff6b6b'},
    {color:'#f6e58d', bg:'#ffbe76'},
    {color:'#44a08d', bg:'#f6e58d'},
    {color:'#4ecdc4', bg:'#44a08d'},
    {color:'#686de0', bg:'#4ecdc4'},
    {color:'#ff7979', bg:'#686de0'},
    {color:'#e056fd', bg:'#ff7979'},
    {color:'#ff7979', bg:'#e056fd'},
    {color:'#ffbe76', bg:'#ff7979'},
    {color:'#f6e58d', bg:'#ffbe76'},
    {color:'#ffbe00', bg:'#f6e58d'},
    {color:'rainbow', bg:'#ffbe00'}
];

function setCookie(name,value,days=30){const d=new Date();d.setTime(d.getTime()+(days*24*60*60*1000));document.cookie=name+"="+encodeURIComponent(value)+";expires="+d.toUTCString()+";path=/";}
function getCookie(name){const cname=name+"=";const decodedCookie=decodeURIComponent(document.cookie);const ca=decodedCookie.split(';');for(let i=0;i<ca.length;i++){let c=ca[i].trim();if(c.indexOf(cname)===0)return c.substring(cname.length,c.length);}return null;}

fetch('fonts.txt')
    .then(resp=>resp.text())
    .then(data=>{
        const styleEl=document.createElement('style');
        styleEl.textContent=data;
        document.head.appendChild(styleEl);
        fontClasses=data.split('\n').map(line=>line.match(/^\.(.+?)\s*\{/)).filter(Boolean).map(match=>match[1].trim());
    })
    .catch(err=>console.error('Error loading fonts.txt:', err));

currentColorObj=sequenceColors[currentColorIndex];
applyColorToBackground(currentColorObj.bg);
updateProgressBar();

function getRandomDigit(){let digit;do{digit=Math.floor(Math.random()*10);}while(lastDigits.includes(digit));lastDigits.push(digit);if(lastDigits.length>5) lastDigits.shift();return digit;}
function getRandomFont(){if(fontClasses.length===0)return ''; let font; do{font=fontClasses[Math.floor(Math.random()*fontClasses.length)];}while(lastFonts.includes(font)&&lastFonts.length<fontClasses.length);lastFonts.push(font);if(lastFonts.length>10) lastFonts.shift();return font;}

function getNextColor(){
    colorClickCounter++;
    let threshold=firstLevelExtraClick?11:10;

    if(colorClickCounter>=threshold){
        colorClickCounter=0;
        currentColorIndex++;
        if(currentColorIndex>=sequenceColors.length) currentColorIndex=0;

        level++;
        setCookie("level",level);
        firstLevelExtraClick=false;

        currentColorObj=sequenceColors[currentColorIndex];
        applyColorToBackground(currentColorObj.bg);

        showConfetti(); // 拽驻 注
        const readBtn=document.getElementById('readBtn');
        readBtn.disabled=true;
        const audioNewLevel=new Audio('newlevel.mp3');
        audioNewLevel.play().catch(err=>console.error(err));
        audioNewLevel.onended=()=>{readBtn.disabled=false;};
    }

    setCookie("colorIndex",currentColorIndex);
    setCookie("colorClickCounter",colorClickCounter);
    updateProgressBar();
    return currentColorObj;
}

function applyColorToBackground(bg){
    const body=document.body;
    if(bg==='rainbow'){body.style.background='linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)';} 
    else {body.style.background=bg;}
}

function updateProgressBar(){
    const progressBar=document.getElementById('progressBar');
    const threshold=firstLevelExtraClick?11:10;
    const percentage=Math.floor((colorClickCounter/threshold)*100);
    progressBar.style.width=percentage+'%';
    progressBar.style.background=(currentColorObj.color==='rainbow')?'linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)':currentColorObj.color;
}

function generateRandomDigit(){
    const digitDisplay=document.getElementById('digitDisplay');
    const generateBtn=document.getElementById('generateBtn');
    const readBtn=document.getElementById('readBtn');
    if(isFirstClick){digitDisplay.innerHTML='';isFirstClick=false;}
    generateBtn.disabled=true;
    const randomDigit=getRandomDigit();
    currentDigit=randomDigit;
    const randomFont=getRandomFont();
    const colorObj=getNextColor();
    digitDisplay.className='digit-display animate';
    if(randomFont) digitDisplay.classList.add(randomFont);
    if(colorObj.color==='rainbow'){digitDisplay.style.background='linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)';digitDisplay.style.webkitBackgroundClip='text';digitDisplay.style.color='transparent';digitDisplay.style.animation='';} 
    else {digitDisplay.style.color=colorObj.color;digitDisplay.style.background='';digitDisplay.style.animation='';}
    digitDisplay.textContent=randomDigit;
    readBtn.classList.add('show');
    setTimeout(()=>{digitDisplay.classList.remove('animate');generateBtn.disabled=false;},300);
}

function playAudio(){
    if(currentDigit===null) return;
    const readBtn=document.getElementById('readBtn');
    readBtn.disabled=true;
    const audio=new Audio(`${currentDigit}.mp3`);
    audio.oncanplaythrough=function(){audio.play().catch(err=>{alert('砖  砖注');readBtn.disabled=false;});};
    audio.onended=function(){readBtn.disabled=false;};
    audio.onerror=function(){alert('砖 注转 砖注');readBtn.disabled=false;};
    setTimeout(()=>{if(readBtn.disabled) readBtn.disabled=false;},3000);
}

// 拽驻 注  - 500 拽, 专转 拽专转
function showConfetti(){
    const colors=['#ff6b6b','#ffbe76','#f6e58d','#44a08d','#4ecdc4','#686de0','#e056fd','#ff7979','#ff9ff3','#f368e0','#ff9f43','#00d2d3'];
    const screenHeight = window.innerHeight;
    for(let i=0;i<500;i++){
        const confetti=document.createElement('div');
        confetti.className='confetti';
        confetti.style.background=colors[Math.floor(Math.random()*colors.length)];
        const size = 5+Math.random()*8;
        confetti.style.width=size+'px';
        confetti.style.height=size+'px';
        const duration = 1+Math.random()*4; // 专转 驻 拽专转
        confetti.style.animationDuration=duration+'s';
        confetti.style.animationDelay=(Math.random()*3)+'s';
        confetti.style.top=(-Math.random()*100)+'px';
        confetti.style.left=Math.random()*100+'vw';

        // 注 keyframes  驻  住
        const fallKeyframes = document.createElement('style');
        const animName = 'fall'+i;
        fallKeyframes.innerHTML = `
        @keyframes ${animName}{
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(${screenHeight + size}px) rotate(720deg); }
        }`;
        document.head.appendChild(fallKeyframes);
        confetti.style.animationName = animName;
        confetti.style.animationTimingFunction = 'linear';
        confetti.style.animationFillMode = 'forwards';

        document.body.appendChild(confetti);

        // 住专 专 住 爪
        confetti.addEventListener('animationend',()=>{confetti.remove(); fallKeyframes.remove();});
    }
}

// 注转  驻 爪'
document.addEventListener('touchstart',e=>{if(e.touches.length>1)e.preventDefault();},{passive:false});
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{ const now=(new Date()).getTime(); if(now-lastTouchEnd<=300)e.preventDefault(); lastTouchEnd=now; },false);
</script>
</body>
</html>
