<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>משחק מספרים וצבעים</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{height:100vh;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;overflow:hidden;font-family:Arial,sans-serif;transition:background 0.5s;}
#colorBar{width:100%;height:20px;margin-bottom:10px;border-radius:5px;transition:background 0.5s;}
#colorSquare{width:200px;height:200px;margin:20px auto;display:flex;justify-content:center;align-items:center;border-radius:20px;box-shadow:0 5px 15px rgba(0,0,0,0.3);font-size:72px;color:white;text-shadow:2px 2px 4px rgba(0,0,0,0.5);transition:transform 0.3s, box-shadow 0.3s;}
#colorSquare:hover{transform:scale(1.05);}
button{padding:12px 24px;font-size:18px;margin:5px;color:white;border:none;border-radius:10px;cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.2);transition:background-color 0.3s, transform 0.1s;}
#foundButton{background-color:#ff9800;}#foundButton:hover{background-color:#fb8c00;}#foundButton:active{transform:scale(0.95);background-color:#f57c00;}
#foundAllButton{background-color:#ff5252;}#foundAllButton:hover{background-color:#ff1744;}
#skipButton{background-color:#9e9e9e;}#skipButton:hover{background-color:#757575;}
#readBtn{background-color:#4ecdc4;}#readBtn:hover{background-color:#44a08d;}
#message,#clickCount,#score,#timer{margin-top:10px;font-size:22px;font-weight:bold;}
.confetti{position:absolute;pointer-events:none;animation:fall linear forwards;}
@keyframes jumpAnim{0%{transform:translateY(0);}50%{transform:translateY(-20px);}100%{transform:translateY(0);}}
@keyframes flashAnim{0%{box-shadow:0 0 15px 5px yellow;}50%{box-shadow:0 0 25px 10px orange;}100%{box-shadow:0 0 15px 5px yellow;}}
</style>
</head>
<body>
<div id="colorBar"></div>
<h1>מצא את הפריט בצבע!</h1>
<div id="colorSquare">מצאתי✋</div>
<div>
  <button id="foundButton">מצאתי✋</button>
  <button id="foundAllButton">מצאתי הכל ✋✋✋</button>
  <button id="skipButton">דלג</button>
  <button id="readBtn">🔊 הקרא</button>
</div>
<p id="clickCount">לחצת: 0 פעמים</p>
<p id="score">נקודות: 0</p>
<p id="timer">זמן: 0 שניות</p>
<p id="message"></p>

<script>
// רקעים לפי סדר
const backgrounds = [
  '#6a6fd5', // כחול
  '#ff6b6b', // אדום
  '#44a08d', // טורקיז
  '#f6e58d', // צהוב
  '#cd7f32', // ארד
  '#c0c0c0', // כסף
  '#ffd700', // זהב
  'rainbow' // קשת
];

// צבעי הריבוע והסרגל לפי סדר
const squareColors = ['#ff6b6b','#44a08d','#f6e58d','#ff6b6b','#44a08d','#f6e58d'];

let bgIndex = 0, stageIndex = 0;
let totalItems, foundCount=0, startTime, score=parseInt(getCookie('score'))||0;
let clickCounterForConfetti=0;
let currentSquareColor='';

// פונקציות קוביות
function setCookie(name,value,days=7){const d=new Date();d.setTime(d.getTime()+(days*24*60*60*1000));document.cookie=name+'='+value+';expires='+d.toUTCString()+';path=/';}
function getCookie(name){let match=document.cookie.match(new RegExp('(^| )'+name+'=([^;]+)'));if(match)return parseInt(match[2]);return 0;}
function updateScoreDisplay(){document.getElementById('score').innerText='נקודות: '+score;}
updateScoreDisplay();

function getRandomDigit(){return Math.floor(Math.random()*10);}
function applyBackground(bg){document.body.style.background = bg==='rainbow'?'linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)':bg;}

function pickColorForBar(){
  const color = squareColors[stageIndex % squareColors.length];
  currentSquareColor = color;
  document.getElementById('colorBar').style.backgroundColor = color;
}

// הפעלת סיבוב חדש (מספר חדש בלבד)
function startRound(){
  const square=document.getElementById('colorSquare');
  let digit = getRandomDigit(); if(digit===0) digit=1;
  square.textContent = digit;
  totalItems = parseInt(digit);
  foundCount = 0;
  startTime = new Date();

  pickColorForBar();
  square.style.backgroundColor = currentSquareColor;
  square.style.color='white';
  
  document.getElementById('foundButton').disabled=false;
  document.getElementById('foundAllButton').disabled=false;
  document.getElementById('clickCount').innerText='לחצת: 0 פעמים';
  document.getElementById('message').innerText='';
  updateScoreDisplay();

  stageIndex++;
}

// פונקציית קונפטי
function showConfetti(){
  const colors=['#ff6b6b','#ffbe76','#f6e58d','#44a08d','#4ecdc4','#686de0','#e056fd','#ff7979','#ff9ff3','#f368e0','#ff9f43','#00d2d3'];
  const count=150; const screenHeight=window.innerHeight;
  for(let i=0;i<count;i++){
    const confetti=document.createElement('div'); confetti.className='confetti';
    confetti.style.background=colors[Math.floor(Math.random()*colors.length)];
    const size=5+Math.random()*8; confetti.style.width=size+'px'; confetti.style.height=size+'px';
    const duration=1+Math.random()*4; confetti.style.animationDuration=duration+'s';
    confetti.style.animationDelay=(Math.random()*3)+'s';
    confetti.style.top=(-Math.random()*100)+'px'; confetti.style.left=Math.random()*100+'vw';
    const animName='fall'+i+Date.now();
    const styleEl=document.createElement('style');
    styleEl.innerHTML=`@keyframes ${animName}{0%{transform:translateY(0) rotate(0deg);}100%{transform:translateY(${screenHeight+size}px) rotate(720deg);}}`;
    document.head.appendChild(styleEl); confetti.style.animationName=animName;
    document.body.appendChild(confetti);
    confetti.addEventListener('animationend',()=>{confetti.remove(); styleEl.remove();});
  }
}

// סיום סיבוב
function finishRound(){
  let endTime=new Date();
  let timeTaken=Math.floor((endTime-startTime)/1000);
  let points=Math.max(10-timeTaken,1);
  score+=points;
  clickCounterForConfetti += points;
  setCookie('score',score,7);
  updateScoreDisplay();

  // קונפטי כל 15 נקודות
  if(clickCounterForConfetti >= 15){
    showConfetti();
    new Audio('Confetti.mp3').play().catch(()=>{});
    new Audio('newlevel.mp3').play().catch(()=>{});
    clickCounterForConfetti = 0;

    // שינוי הרקע והמספר מיד לאחר הקונפטי
    applyBackground(backgrounds[bgIndex]);
    bgIndex++; if(bgIndex >= backgrounds.length) bgIndex=0;
    startRound(); 
  } else {
    // אחרת רק מספור חדש לסיבוב
    startRound();
  }
}

// לחיצות וכפתורים
document.getElementById('foundButton').onclick = () => {
  foundCount++;
  document.getElementById('clickCount').innerText='לחצת: '+foundCount+' פעמים';
  const square=document.getElementById('colorSquare');
  square.classList.remove('jump','flash'); void square.offsetWidth; square.classList.add('jump','flash');

  if(foundCount===totalItems){
    document.getElementById('foundButton').disabled=true;
    document.getElementById('foundAllButton').disabled=true;
    finishRound();
    document.getElementById('message').innerText='סיימת את הסיבוב!';
  }
};

document.getElementById('foundAllButton').onclick = () => {
  foundCount = totalItems;
  document.getElementById('foundButton').disabled=true;
  document.getElementById('foundAllButton').disabled=true;
  finishRound();
  document.getElementById('message').innerText='סיימת את הסיבוב!';
};

document.getElementById('skipButton').onclick = () => {
  document.getElementById('message').innerText='דלגת על הסיבוב!';
  startRound();
};

document.getElementById('readBtn').onclick = () => {
  const digit=document.getElementById('colorSquare').textContent;
  if(!digit) return;
  new Audio(`${digit}.mp3`).play().catch(()=>{});
};

setInterval(()=>{
  if(startTime){
    let elapsed=Math.floor((new Date()-startTime)/1000);
    document.getElementById('timer').innerText='זמן: '+elapsed+' שניות';
  }
},1000);

applyBackground(backgrounds[bgIndex]);
startRound();
</script>
</body>
</html>

